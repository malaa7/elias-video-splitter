<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elias Video Splitter 4 WhatsApp</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Elias Video Splitter<span>4 WhatsApp</span></h1>
    </div>

    <!-- Upload -->
    <div id="upload" class="section active">
      <div id="drop-zone" class="upload-area">
        <div class="upload-icon">๐ฑ</div>
        <h2>ุงุฎุชุฑ ููุฏูู ุฃู ุงุณุญุจ ูุฃููุช ููุง</h2>
        <p>ุชูุณูู ุงุญุชุฑุงูู ูููุฏูููุงุช ุงููุงุชุณุงุจ ุณุชูุฑู</p>
        <input type="file" id="video-input" accept="video/*" hidden>
        <button class="btn" onclick="document.getElementById('video-input').click()">ุงุณุชุนุฑุงุถ ุงููููุงุช</button>
      </div>
    </div>

    <!-- Settings -->
    <div id="settings" class="section">
      <div class="file-info">
        <div class="file-details">
          <i>๐ฌ</i>
          <div>
            <div id="file-name" class="file-name">-</div>
            <div style="color: #666;">
              ุงููุฏุฉ: <span id="file-duration">-</span> | ุงูุญุฌู: <span id="file-size">-</span>
            </div>
          </div>
        </div>
        <button class="btn" onclick="resetFile()" style="width:auto; padding:12px 25px;">ุฅุฒุงูุฉ</button>
      </div>
      
      <div class="settings-group">
        <label>ูุฏุฉ ูู ููุทุน</label>
        <div class="segmented">
          <input type="radio" name="duration" value="15" id="d15"><label for="d15">15ุซ</label>
          <input type="radio" name="duration" value="30" id="d30" checked><label for="d30">30ุซ</label>
          <input type="radio" name="duration" value="45" id="d45"><label for="d45">45ุซ</label>
          <input type="radio" name="duration" value="60" id="d60"><label for="d60">60ุซ</label>
        </div>
      </div>
      
      <div class="settings-group">
        <label>ุฌูุฏุฉ ุงูุฅุฎุฑุงุฌ</label>
        <div class="segmented">
          <input type="radio" name="quality" value="high" id="qh" checked><label for="qh">ุนุงููุฉ</label>
          <input type="radio" name="quality" value="medium" id="qm"><label for="qm">ูุชูุณุทุฉ</label>
          <input type="radio" name="quality" value="low" id="ql"><label for="ql">ูุงุชุณุงุจ</label>
        </div>
      </div>
      
      <button class="btn" onclick="startProcessing()">๐ ูุณูู ุงูููุฏูู ุงูุขู</button>
    </div>

    <!-- Processing -->
    <div id="processing" class="section">
      <div class="loader"></div>
      <div id="status-text" class="status-text">ุฌุงุฑู ุงูุชุญุถูุฑ...</div>
      <div class="progress"><div id="progress-bar" class="progress-bar"></div></div>
    </div>

    <!-- Results -->
    <div id="results" class="section">
      <div class="success-icon">โ</div>
      <h2>ุชู ุจูุฌุงุญ!</h2>
      <p id="result-summary">ุชู ุฅูุดุงุก 0 ููุงุทุน</p>
      <button class="btn" onclick="downloadAllZip()">๐ฆ ุชุญููู ุงููู (ZIP)</button>
      <button class="btn" onclick="location.reload()" style="background:#6c757d;margin-top:10px;">๐ ููุฏูู ุฌุฏูุฏ</button>
      <div class="clips-grid" id="clips-grid"></div>
    </div>
  </div>

  <script>
    let uploadedFilename = '';
    let outputDir = '';
    let clipsData = [];
    
    document.getElementById('video-input').addEventListener('change', (e) => {
      if (e.target.files[0]) uploadFile(e.target.files[0]);
    });
    
    const dropZone = document.getElementById('drop-zone');
    ['dragenter', 'dragover'].forEach(e => {
      dropZone.addEventListener(e, (ev) => { ev.preventDefault(); dropZone.classList.add('dragover'); });
    });
    ['dragleave', 'drop'].forEach(e => {
      dropZone.addEventListener(e, (ev) => { ev.preventDefault(); dropZone.classList.remove('dragover'); });
    });
    dropZone.addEventListener('drop', (e) => {
      if (e.dataTransfer.files[0]) uploadFile(e.dataTransfer.files[0]);
    });
    
    async function uploadFile(file) {
      const formData = new FormData();
      formData.append('video', file);
      
      try {
        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();
        
        if (data.success) {
          uploadedFilename = data.filename;
          document.getElementById('file-name').textContent = file.name;
          document.getElementById('file-size').textContent = (data.size/1024/1024).toFixed(1) + ' ููุฌุง';
          const mins = Math.floor(data.duration/60);
          const secs = Math.floor(data.duration%60).toString().padStart(2,'0');
          document.getElementById('file-duration').textContent = `${mins}:${secs}`;
          showSection('settings');
        }
      } catch (e) {
        alert('ุฎุทุฃ ูู ุฑูุน ุงูููู');
      }
    }
    
    async function startProcessing() {
      if (!uploadedFilename) return alert('ุงุฎุชุฑ ููุฏูู ุฃููุงู');
      
      showSection('processing');
      const duration = document.querySelector('input[name="duration"]:checked').value;
      const quality = document.querySelector('input[name="quality"]:checked').value;
      
      try {
        const res = await fetch('/split', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ filename: uploadedFilename, duration, quality })
        });
        
        const data = await res.json();
        if (data.success) {
          clipsData = data.clips;
          outputDir = data.output_dir;
          document.getElementById('result-summary').textContent = `ุชู ุฅูุดุงุก ${clipsData.length} ููุทุน ููุฏูู`;
          renderClips();
          showSection('results');
        }
      } catch (e) {
        alert('ุฎุทุฃ ูู ุงููุนุงูุฌุฉ');
      }
    }
    
    function renderClips() {
      const grid = document.getElementById('clips-grid');
      grid.innerHTML = '';
      clipsData.forEach(clip => {
        const div = document.createElement('div');
        div.className = 'clip';
        div.innerHTML = `
          <div style="font-size:2rem;">๐ฌ</div>
          <div class="clip-name">${clip.name}</div>
          <div style="color:#666;font-size:0.9rem;">${(clip.size/1024/1024).toFixed(1)} ููุฌุง</div>
          <button class="clip-download" onclick="downloadClip('${clip.path}')">๐ฅ ุชุญููู</button>
        `;
        grid.appendChild(div);
      });
    }
    
    function downloadClip(path) {
      window.location.href = `/download/${path}`;
    }
    
    function downloadAllZip() {
      window.location.href = `/download-zip/${outputDir}`;
    }
    
    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
    
    function resetFile() {
      if (uploadedFilename) fetch(`/cleanup/${uploadedFilename}`);
      location.reload();
    }
  </script>
</body>
</html>
